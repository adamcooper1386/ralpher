{
  "tasks": [
    {
      "id": "prompt-composition",
      "title": "Pass task context to agent command",
      "status": "done",
      "acceptance": [
        "Agent receives current task id, title, and acceptance criteria",
        "Agent receives instruction to write task_update.json",
        "Prompt is composed dynamically, not hardcoded in config"
      ],
      "notes": "Task was already implemented. The compose_prompt method in run.rs creates dynamic prompts with task id, title, acceptance criteria, and instructions to write task_update.json. The execute_agent method passes this prompt via -p flag. All checks pass (fmt, check, clippy, 53 tests)."
    },
    {
      "id": "task-update-parsing",
      "title": "Parse task_update.json from agent output",
      "status": "done",
      "acceptance": [
        "After agent runs, check for .ralpher/task_update.json",
        "Parse task_id, new_status, notes fields",
        "Update task status in ralpher.prd.json",
        "Emit TaskStatusChanged event"
      ],
      "notes": "Task update parsing was already fully implemented in src/run.rs: TaskUpdate struct defined with task_id/new_status/notes fields, parse_task_update() parses .ralpher/task_update.json, next_iteration() updates task status in ralpher.prd.json and emits TaskStatusChanged event. All checks pass (53 unit tests, 26 integration tests)."
    },
    {
      "id": "checkpoint-commits",
      "title": "Commit checkpoint after successful iteration",
      "status": "done",
      "acceptance": [
        "After validators pass, commit all changes",
        "Commit message format: ralpher: it<N> task <id> - <title>",
        "Update run.last_checkpoint with new SHA",
        "Emit CheckpointCreated event"
      ],
      "notes": "The checkpoint-commits feature was already implemented in the codebase. Verified that: (1) After validators pass, WorkspaceManager.checkpoint() is called from RunEngine.next_iteration() to commit all changes; (2) Commit message uses format 'ralpher: it<N> task <id> - <title>'; (3) run.last_checkpoint is updated with the new SHA in RunEngine.checkpoint(); (4) CheckpointCreated event is emitted with run_id, iteration, and commit_sha. Added two new unit tests to verify the checkpoint behavior: test_checkpoint_after_successful_iteration and test_checkpoint_includes_task_status_changes. All 55 unit tests and 26 integration tests pass."
    },
    {
      "id": "validator-execution",
      "title": "Execute validator commands",
      "status": "done",
      "acceptance": [
        "Run configured validators after agent completes",
        "Capture exit codes and output",
        "Emit ValidatorResult events",
        "Validators passing required for checkpoint"
      ],
      "notes": "Implemented validator execution: added validators config field, execute_validators method in RunEngine that runs shell commands and captures exit codes/output, emits ValidatorResult events for each validator, gates checkpoint creation on all validators passing. Added run_validators_standalone function for `ralpher validate` command. Includes 5 new unit tests and 3 new integration tests. All 60 unit tests and 29 integration tests pass."
    },
    {
      "id": "policy-engine",
      "title": "Implement policy engine for diff checking",
      "status": "done",
      "acceptance": [
        "After agent runs, compute git diff --name-status",
        "Check for policy violations (deletes, renames by default)",
        "Support allow/deny path patterns in config",
        "Emit PolicyViolation events on violation",
        "Configurable action on violation: abort, reset, or keep"
      ],
      "notes": "Implemented policy engine for diff checking with: deny_deletes/deny_renames by default, allow/deny path patterns with glob support, PolicyViolation events emitted on violations, configurable violation actions (abort/reset/keep). Added 31 new tests."
    },
    {
      "id": "iteration-loop",
      "title": "Run iterations until completion or budget",
      "status": "done",
      "acceptance": [
        "ralpher continue runs multiple iterations, not just one",
        "Stop when all tasks done or max_iterations reached",
        "Stop on policy violation (configurable)",
        "Support pause via signal or future TUI control"
      ],
      "notes": "Implemented iteration loop: (1) ralpher continue now runs multiple iterations until completion via run_iterations(); (2) Added configurable max_iterations in ralpher.toml (default 100) - stops and pauses when limit reached; (3) Policy violations already stop runs based on on_violation config (abort/reset/keep); (4) Added Ctrl+C signal handling for graceful pause - first Ctrl+C pauses after current iteration, second exits immediately. Added 3 new unit tests for max_iterations config. All 85 unit tests and 29 integration tests pass."
    },
    {
      "id": "tui-basic",
      "title": "Basic TUI with progress display",
      "status": "done",
      "acceptance": [
        "Show current run state, iteration count, elapsed time",
        "Show task list with status indicators",
        "Show current task details",
        "Show progress percentage",
        "Live update from events.ndjson"
      ],
      "notes": "Implemented basic TUI with ratatui + crossterm. Features: header showing run state/iteration/elapsed time, progress gauge, task list with status indicators, current task details panel, live event log that reads incrementally from events.ndjson. Supports 'q' to quit and 'r' to refresh. Auto-refreshes every 250ms."
    },
    {
      "id": "tui-log-panel",
      "title": "TUI log panel for agent/validator output",
      "status": "done",
      "acceptance": [
        "Bottom panel shows live log tail",
        "Toggle between agent and validator logs",
        "Scroll through log history"
      ],
      "notes": "Implemented TUI log panel with: LogSource enum for agent/validator toggle, live log tail display in bottom panel, 'l' key to toggle log source, j/k/PageUp/PageDown/Home/End for scrolling, incremental agent log reading, validator JSON parsing and formatting, syntax highlighting for errors/warnings/pass/fail"
    },
    {
      "id": "tui-controls",
      "title": "TUI keybindings for pause/abort/skip",
      "status": "done",
      "acceptance": [
        "Space to pause/resume",
        "a to abort",
        "s to skip current task",
        "q to quit",
        "Actions emit appropriate events"
      ],
      "notes": "Implemented TUI controls: (1) Added TuiAction enum for Pause/Resume/Abort/Skip/Quit; (2) Space key toggles pause/resume based on run state; (3) 'a' key aborts active runs; (4) 's' key skips current task by marking it blocked; (5) 'q' key quits TUI (pauses if running); (6) Added skip_task() method to RunEngine that marks task as blocked and emits TaskStatusChanged event; (7) Integrated TUI with engine via run_with_tui() function; (8) Added --headless flag to continue/start commands; (9) Dynamic footer shows available controls based on run state. All 101 unit tests and 29 integration tests pass."
    },
    {
      "id": "task-10",
      "title": "make initial task generation based on prd instead of manual",
      "status": "done",
      "notes": "Added PRD parser module that extracts user stories and acceptance criteria from markdown PRD files. Integrated into setup wizard to auto-import tasks when a prd.md file is detected. Setup UI now shows imported tasks with acceptance criteria counts, and provides controls to re-import (i) or clear (c) tasks."
    },
    {
      "id": "task-11",
      "title": "Update ralpher to integrate with Archon for task management",
      "status": "todo",
      "acceptance": [
        "Add archon mcp configuration to tui setup wizard",
        "Add functionality to tui to migrate from local to archon",
        "add functionality to tui to migrate from archon to local",
        "update promts to ai to respect archon configuration, and use archon RAG when appropriate"
      ]
    }
  ]
}