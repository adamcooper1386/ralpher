version: 1
binary: ../target/release/ralpher

sandbox:
  workdir: temp
  inherit_env: true

tests:
  - name: "iteration without config fails"
    steps:
      - name: run
        run:
          cmd: "${BINARY}"
          args: ["--iteration"]
        expect:
          exit: 1
          stderr:
            contains: "No ralpher.toml found"

  - name: "start without config fails"
    steps:
      - name: run
        run:
          cmd: "${BINARY}"
          args: ["--start"]
        expect:
          exit: 1
          stderr:
            contains: "No ralpher.toml found"

  - name: "validate without config fails"
    steps:
      - name: run
        run:
          cmd: "${BINARY}"
          args: ["--validate"]
        expect:
          exit: 1
          stderr:
            contains: "No ralpher.toml found"

  - name: "status without config shows message"
    steps:
      - name: run
        run:
          cmd: "sh"
          args: ["-c", "RUST_LOG=info ${BINARY} --status 2>&1"]
        expect:
          exit: 0
          stdout:
            contains: "no ralpher.toml found"

  - name: "abort without config fails"
    steps:
      - name: run
        run:
          cmd: "${BINARY}"
          args: ["--abort"]
        expect:
          exit: 1
          stderr:
            contains: "No ralpher.toml found"

  - name: "clean without .ralpher shows nothing to clean"
    steps:
      - name: run
        run:
          cmd: "sh"
          args: ["-c", "RUST_LOG=info ${BINARY} --clean 2>&1"]
        expect:
          exit: 0
          stdout:
            contains: "no .ralpher/ directory found"
