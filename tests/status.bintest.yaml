version: 1
binary: ../target/release/ralpher

sandbox:
  workdir: temp

tests:
  - name: "status with config but no run shows no active run"
    setup:
      - write_file:
          path: "ralpher.toml"
          contents: |
            # minimal config
    steps:
      - name: run
        run:
          cmd: "sh"
          args: ["-c", "RUST_LOG=info ${BINARY} status 2>&1"]
        expect:
          exit: 0
          stdout:
            contains: "no active run"

  - name: "status with config and tasks shows progress"
    setup:
      - write_file:
          path: "ralpher.toml"
          contents: |
            # minimal config
      - write_file:
          path: "ralpher.prd.json"
          contents: |
            {
              "tasks": [
                {"id": "t1", "title": "Task one", "status": "done"},
                {"id": "t2", "title": "Task two", "status": "todo"}
              ]
            }
    steps:
      - name: run
        run:
          cmd: "sh"
          args: ["-c", "RUST_LOG=info ${BINARY} status 2>&1"]
        expect:
          exit: 0
          stdout:
            contains: "task status"
