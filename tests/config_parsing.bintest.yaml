version: 1
binary: ../target/release/ralpher

sandbox:
  workdir: temp
  inherit_env: true

tests:
  - name: "invalid config fails gracefully"
    setup:
      - write_file:
          path: "ralpher.toml"
          contents: |
            git_mode = "invalid_mode"
    steps:
      - name: run
        run:
          cmd: "${BINARY}"
          args: ["--iteration"]
        expect:
          exit: 1
          stderr:
            contains: "Failed to parse"

  - name: "malformed toml fails gracefully"
    setup:
      - write_file:
          path: "ralpher.toml"
          contents: |
            this is not valid toml [[[
    steps:
      - name: run
        run:
          cmd: "${BINARY}"
          args: ["--iteration"]
        expect:
          exit: 1
          stderr:
            contains: "Failed to parse"
